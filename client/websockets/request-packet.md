# Request Packets

The WebSocket API allows for a client to send requests to the server.  While the long term goal is to support all REST API calls via the WebSocket, initially, only a few such requests are supported.  There are also some WebSocket-Only requests that can be made (See [Recovery](#recovery)).

Currently there only two requests supported (not counting those in [Recovery](#recovery)):

* Create a Message
* Create a Conversation

There are two types of Packets that need to be understood for a complete transaction:

* Request Packets
* Response Packets

## Request Packet Details

The `body` field of a Request Packet will have the following properties:

| Field      | Type   | Description |
|------------|--------|-------------|
| **request_id** | string | An identifier created by the client to allow it to recognize a response |
| **method** | string | Message.create, Conversation.create |
| **object_id** | string | ID of the object the request concerns; optional |
| **data** | object | Each method defines what the data looks like |


### The `request_id`  Field

When the client sends a Request Packet to the server, it can include an arbitrary string (containing letters, numbers, dashes, underscores and periods), that will be returned with a WebSocket response so that the response can be associated with the request.  The Client is responsible for creating the string, which must match:

```text
 /^[a-zA-Z0-9.-]+$/
 ```

If the `request_id` field is omitted, then the server will not send a Response Packet to the client.

A Response Packet will be sent to the client with the `request_id` provided in the request.  If your requests need JavaScript callbacks to be invoked on receiving success/error responses, then this `request_id` is the only hint you have that a response is associated with a specific request and callback.

## Response Packet Details

The `body` field of a Response Packet will have the following properties:

| Field      | Type   | Description |
|------------|--------|-------------|
| **request_id** | string | Echos back the request_id sent by the client |
| **method** | string | Message.create, Conversation.create |
| **data** | object | Each method defines what the data looks like |
| **success** | boolean | true if the operation was a success; false if not |

## Create Requests

For all create calls, the fields to provide in the `data` field will match those documented in the REST API in [Create a Conversation](rest#create-a-conversation) and [Send a Message](rest#send-a-message), and will not be documented here.  There is one additional field of these requests: an `id` field where you specify what the ID of the object will be.

The responses generated by these will have a `data` field that either contains the object that was created, or an Error and described in [Errors](rest#errors).

### Create Message Example

The following request will attempt to create a message within a Conversation whose ID is `layer:///conversations/e67b5da2-95ca-40c4-bfc5-a2a8baaeb50f`:

```json
{
  "type": "request",
  "body": {
    "method": "Message.create",
    "request_id": "fred.flinstone.3",
    "object_id": "layer:///conversations/e67b5da2-95ca-40c4-bfc5-a2a8baaeb50f",
    "data": {
      "parts": [
        {
          "mime_type": "text/plain",
          "body": "This is the message."
        },
        {
          "mime_type": "image/png",
          "content": {
            "id": "layer:///content/7a0aefb8-3c97-11e4-baad-164230d1df67",
            "size": 172114124
          }
        }
      ],
      "notification": {
        "title": "On the beach",
        "text": "All rise, its a Message!",
        "sound": "salute.aiff"
      }
    }
  }
}
```
Notification objects can be created using the notificaton customization definition that can be found at: [Push Notifications](https://developer.layer.com/docs/client/introduction#notification-customization).
The following are possible responses:

_ERROR_:

```json
{
  "type": "response",
  "counter": 18,
  "timestamp": "2015-01-19T09:15:43+00:00",
  "body": {
    "request_id": "fred.flinstone.3",
    "method": "Message.create",
    "success": false,
    "data": {
      "code": 102,
      "id": "not_found",
      "message": "The Conversation could not be found.",
      "url": "http://api.layer.com/wtf"
    }
  }
}
```

_SUCCESS_:

```json
{
  "type": "response",
  "counter": 16,
  "timestamp": "2015-01-19T09:15:43+00:00",
  "body": {
    "request_id": "fred.flinstone.3",
    "method": "Message.create",
    "success": true,
    "data": <Message>
  }
}
```

### Deduplication

When creating a resource, it is optional whether to include an `id` field.  Doing so is useful for [deduplication](introduction#deduplication).  A deduplication error typically indicates that the requested resource has already been created.

_DEDUPLICATION ERROR_:
```json
{
  "type": "response",
  "counter": 18,
  "timestamp": "2015-01-19T09:15:43+00:00",
  "body": {
    "request_id": "fred.flinstone.3",
    "method": "Message.create",
    "success": false,
    "data": {
      "id": "id_in_use",
      "code": 111,
      "message": "The requested Message already exists",
      "url": "https://developer.layer.com/docs/client/websockets#create-requests",
      "data": <Message>
    }
  }
}
```

Typical usage by a Client of this `id_in_use` error is to report back to the caller that the Message/Conversation has been successfully created, delivering `body.data.data` which contains the Message/Conversation object to the caller. No further deduplication retries are needed at this point.

